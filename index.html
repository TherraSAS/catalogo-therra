<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Catálogo TherrA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

  <style>
    :root {
      --cream: #f6f3ef;
      --dark: #1f2933;
      --muted: #6b7280;
      --accent: #25d366;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background: var(--cream);
      color: var(--dark);
    }

    header {
      padding: 24px 32px;
      display: flex;
      align-items: center;
      gap: 20px;
    }

    header img { height: 42px; }

    header h1 {
      font-size: 18px;
      font-weight: 500;
      margin: 0;
    }

    .filters {
      padding: 0 32px 10px;
    }

    .filters select {
      padding: 10px;
      border-radius: 10px;
      border: 1px solid #ddd;
      font-size: 14px;
    }

    .grid {
      padding: 32px;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 28px;
    }

    .card {
      background: #fff;
      border-radius: 18px;
      overflow: hidden;
      transition: transform .25s ease, box-shadow .25s ease;
    }

    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 18px 40px rgba(0,0,0,.08);
    }

    .image-wrap {
      background: #fafafa;
      aspect-ratio: 1 / 1;
    }

    .image-wrap img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      padding: 18px;
    }

    .content {
      padding: 18px 20px 22px;
    }

    .tag {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--muted);
      display: block;
      margin-bottom: 6px;
    }

    h3 {
      font-size: 15px;
      font-weight: 500;
      margin: 0 0 6px;
    }

    .meta {
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 10px;
    }

    select, input {
      width: 100%;
      padding: 8px;
      margin-top: 6px;
      font-size: 13px;
      border-radius: 8px;
      border: 1px solid #ddd;
    }

    .btn {
      display: block;
      margin-top: 12px;
      background: var(--accent);
      color: white;
      text-align: center;
      padding: 10px;
      border-radius: 30px;
      font-size: 14px;
      font-weight: 600;
      text-decoration: none;
    }

    footer {
      text-align: center;
      padding: 28px;
      font-size: 12px;
      color: #999;
    }
  </style>
</head>

<body>

<header>
  <img src="https://therra.co/wp-content/uploads/2025/11/cropped-logotherrabbb.png">
  <h1>Catálogo de Herrajes</h1>
</header>

<div class="filters">
  <select id="catFilter">
    <option value="">Todas las categorías</option>
  </select>
</div>

<div class="grid" id="grid"></div>

<footer>
  © TherrA · Moda & Herrajes Premium
</footer>

<script>
const API_URL =
  "https://script.google.com/macros/s/AKfycbwO-EJrvFYIttP_gwQlIj0EPjZWRg2qmdyTRIWTbfb3C68apWReNy9sK3KytG0kI4jNQA/exec";

const LOGO_FALLBACK =
  "https://therra.co/wp-content/uploads/2025/11/cropped-logotherrabbb.png";

const ACABADOS = [
  "Niquel Brillante",
  "Niquel Mate",
  "Niquel Negro",
  "Onix",
  "Oro Rosa",
  "Cobre Pavón",
  "Dorado",
  "Latón Pavón",
  "Niquel Free",
  "GNC",
  "Galvanizado Negro Mate",
  "Otro (especificar)"
];

function normalizeKey(key) {
  return key.normalize("NFD")
    .replace(/[\u0300-\u036f]/g, "")
    .replace(/\s+/g, "_")
    .toUpperCase();
}

function fixDriveUrl(url) {
  if (!url) return LOGO_FALLBACK;
  const match = url.match(/[-\w]{25,}/);
  return match ? "https://lh3.googleusercontent.com/d/" + match[0] : url;
}

let ALL_DATA = [];

async function loadData() {
  const res = await fetch(API_URL);
  const raw = JSON.parse(await res.text());

  ALL_DATA = raw
    .map(row => {
      const o = {};
      Object.keys(row).forEach(k => o[normalizeKey(k)] = row[k]);
      return o;
    })
    .filter(item =>
      item.ESTADO &&
      item.ESTADO.toString().toLowerCase().trim() === "activo web"
    );

  buildCategoryFilter();
  renderCards(ALL_DATA);
}

function buildCategoryFilter() {
  const select = document.getElementById("catFilter");
  const categories = [...new Set(
    ALL_DATA.map(i => i.CATEGORIA).filter(Boolean)
  )];

  select.innerHTML =
    `<option value="">Todas las categorías</option>` +
    categories.map(c => `<option value="${c}">${c}</option>`).join("");

  select.onchange = () => {
    const filtered = !select.value
      ? ALL_DATA
      : ALL_DATA.filter(i => i.CATEGORIA === select.value);
    renderCards(filtered);
  };
}

function renderCards(data) {
  const grid = document.getElementById("grid");
  grid.innerHTML = "";

  data.forEach(item => {
    const card = document.createElement("div");
    card.className = "card";

    card.innerHTML = `
      <div class="image-wrap">
        <img src="${fixDriveUrl(item.IMAGEN)}"
             onerror="this.src='${LOGO_FALLBACK}'">
      </div>

      <div class="content">
        <span class="tag">${item.CATEGORIA || ""}</span>
        <h3>${item.DESCRIPCION || "SIN DESCRIPCIÓN"}</h3>

        <div class="meta">
          Ref: ${item.REFERENCIA || ""}<br>
          Stock: ${item.CANTIDAD_EN_STOCK || ""}
        </div>

        <select class="acabado">
          ${ACABADOS.map(a => `<option value="${a}">${a}</option>`).join("")}
        </select>

        <input class="acabado-custom"
          type="text"
          placeholder="Escriba el acabado"
          style="display:none">

        <a class="btn" target="_blank">Consultar por WhatsApp</a>
      </div>
    `;

    const select = card.querySelector(".acabado");
    const input = card.querySelector(".acabado-custom");
    const btn = card.querySelector(".btn");

    function updateWhatsapp() {
      const acabado =
        select.value === "Otro (especificar)"
          ? input.value || "No especificado"
          : select.value;

      const msg =
        `Hola, me interesa la referencia ${item.REFERENCIA}\n` +
        `Producto: ${item.DESCRIPCION}\n` +
        `Acabado: ${acabado}`;

      btn.href = "https://wa.me/573004847428?text=" + encodeURIComponent(msg);
    }

    select.onchange = () => {
      input.style.display =
        select.value === "Otro (especificar)" ? "block" : "none";
      updateWhatsapp();
    };

    input.oninput = updateWhatsapp;
    updateWhatsapp();

    grid.appendChild(card);
  });
}

loadData();
</script>

</body>
</html>




